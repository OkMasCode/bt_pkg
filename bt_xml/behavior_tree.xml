<root main_tree_to_execute="MainTree">

    <BehaviorTree ID="MainTree">

        <Sequence name="MissionPipeline">
            <ReadJson 
                file_path="/home/sensor/ros2_ws/src/yolo11_seg_bringup/config/robot_command.json"
                candidats_ids="{candidates}" 
                prompt="{clip_prompt}" 
                cluster_id="{cluster}" 
            />

            <Fallback name="CheckOrExplore">

                <Sequence name="NavigateToKnownGoal">
                    <CallCheckCandidates 
                        candidats_ids="{candidates}" 
                        target_pose="{target_pose}"
                    />
                    <NavigateToPose goal="{target_pose}"/>
                </Sequence>

                <Sequence name="NavigateToCentroid">
                    <SelectCluster 
                        input_clusters="{cluster_id}" 
                        selected_pose="{search_pose}"
                    />
                    <NavigateToPose goal="{search_pose}"/>
                </Sequence>

            </Fallback>

        </Sequence>
        
    </BehaviorTree>

    <TreeNodesModel>
        <Action ID="ReadJson">
            <input_port name="file_path"/>
            <output_port name="candidats_ids"/>
            <output_port name="prompt"/>
            <output_port name="cluster"/>
        </Action>
        <Action ID="CallCheckCandidates">
            <input_port name="candidats_ids"/>
            <output_port name="target_pose"/>
        </Action>
        <Action ID="SelectCluster">
            <input_port name="input_clusters"/>
            <output_port name="selected_pose"/>
        </Action>
        <Action ID="NavigateToPose">
            <input_port name="goal"/>
        </Action>
    </TreeNodesModel>
</root>